(function(e){function t(a){if(r[a])return r[a].exports;var l=r[a]={i:a,l:!1,exports:{}};return e[a].call(l.exports,l,l.exports,t),l.l=!0,l.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var r=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(r,'a',r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=17)})([function(e,t,r){'use strict';function a(e){return e&&e.__esModule?e:{default:e}}var l=r(1),o=a(l),d=r(2),s=a(d),n=r(26),u=r(27);n.configure(u);var i=function(e){return n.getLogger(e)};e.exports={logFile:i,httpHead:function(){var e=i();return function(){var t=(0,s.default)(o.default.mark(function t(r,a){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.info('httpHeadMethod:',r.method),e.info('httpHeadUrl:',r.originalUrl),e.info('ip:',r.request.ip),t.next=5,a();case 5:case'end':return t.stop();}},t,this)}));return function(){return t.apply(this,arguments)}}()}}},function(e){e.exports=require('babel-runtime/regenerator')},function(e){e.exports=require('babel-runtime/helpers/asyncToGenerator')},function(e){e.exports=require('babel-runtime/helpers/defineProperty')},function(e,t,r){'use strict';/*!
 * consts.js v1.0.0
 * 常量列表js，主要是用来存一些常量，避免大家都各自在各个地方定义常量，便于统一管理<br>
 * 缓存的前缀和key需要注意，不能重复，所以，缓存的前缀，大家尽量按照模块名称来取，保证前缀不重复，例如登录的相关信息，前缀都用login
 * key也都在这里统一定义，这样就可以很明确的知道那些名字已经被占用了，已经存在了。
 * Author:
 * Date:
 * 使用方法：
 *        import consts from common/consts.js
 *        consts.ERROR_CODE.SUCCESS
 */var a,l=r(3),o=function(e){return e&&e.__esModule?e:{default:e}}(l),d=(a={SUCCESS:1e4,UNKNOWN_ERROR:2e4,SIGNATURE_ERROR:20004,SERVICE_NOTEXISTS:20005,PARAM_NULL:20001,PARAM_TYPE_ERROR:20006,PARAM_FORMAT_ERROR:20007,PARAM_OVER_ERROR:20003,PARAM_NULL_ERROR:20013,INTERNAL_SERVER_ERROR:20008,DATA_FORMAT_ERROR:20009,PARAM_LENGTH_OVER:20010,CHECK_ALREADY_EXISTS:20011},(0,o.default)(a,'CHECK_ALREADY_EXISTS',20011),(0,o.default)(a,'NO_ACCESS_TOKEN',61003),(0,o.default)(a,'NO_SECURITY_ID',61004),(0,o.default)(a,'PHONENUM_OCCUPY',61005),(0,o.default)(a,'ALREADY_EXIST',61006),(0,o.default)(a,'SEND_CODE_FAIL',61007),(0,o.default)(a,'INSTANCE_ID_NO_SECURITY_ID',61011),(0,o.default)(a,'INSTANCE_ID_NO_ACCESS_TOKEN',61012),(0,o.default)(a,'CODE_EXPIRED',61013),(0,o.default)(a,'INNER_ERROR',61014),(0,o.default)(a,'PROGRAM_ERROR',61015),(0,o.default)(a,'GRAPHICAL_ERROE',61016),(0,o.default)(a,'CODE_ERROR',61017),(0,o.default)(a,'UNAUTHORIZED_ACCESS',61018),(0,o.default)(a,'NO_OBJECT',61019),(0,o.default)(a,'USERNAME_OR_PASS_ERRROR',61020),(0,o.default)(a,'ACCOUNT_CANCELLATION',61024),a);e.exports={ERROR_CODE:d}},function(e){'use strict';e.exports='progress'==process.env.BRANCH_ENV?{port:8081,database:{DATABASE:'skd',USERNAME:'root',PASSWORD:'yan123456',PORT:'3306',HOST:'127.0.0.1'},upload:{UPLOAD:'/upload',IMAGE:'/image/',FILE:'/file/',MAXFILESIZE:209715200}}:{port:8081,database:{DATABASE:'skd',USERNAME:'root',PASSWORD:'yan123456',PORT:'3306',HOST:'127.0.0.1'},upload:{UPLOAD:'/upload',IMAGE:'/image/',FILE:'/file/',MAXFILESIZE:209715200}}},function(e){e.exports=require('babel-runtime/core-js/json/stringify')},function(e){e.exports=require('sequelize')},function(e,t,r){'use strict';var a=r(6),l=function(e){return e&&e.__esModule?e:{default:e}}(a),o=r(7),d=r(5),s=r(31),n=r(0),u=n.logFile('sequelize-mysql'),i=new o(d.database.DATABASE,d.database.USERNAME,d.database.PASSWORD,{host:d.database.HOST,dialect:'mysql',pool:{max:5,min:0,idle:1e4},define:{timestamps:!1}});i.authenticate().then(function(){u.info('sequelize-log_start start!')}).catch(function(e){u.error('Unable to connect to the database:',(0,l.default)(e)),s.sendEmail('shanyanwt@163.com','Mysql-error','shanyanwt@163.com','Mysql \u8FDE\u63A5\u5931\u8D25','<p>\u9519\u8BEF\u4FE1\u606F: </p>'+(0,l.default)(e)+'<p>\u8BF7\u4F60\u53CA\u65F6\u5904\u7406</p >').then(function(){u.info('mysql\u9519\u8BEF\u90AE\u7BB1\u63D0\u793A\u53D1\u9001\u6210\u529F\uFF01')}).catch(function(e){u.error('mysql\u9519\u8BEF\u90AE\u7BB1\u63D0\u793A\u53D1\u9001\u5931\u8D25\uFF01',e)})}),e.exports={Admin:r(33)(i,o),Article:r(34)(i,o),Role:r(35)(i,o),MysqlSessionStore:r(36)(i,o)}},function(e){e.exports=require('babel-runtime/core-js/promise')},function(e,t,r){'use strict';(function(t){var a=r(0),l=a.logFile(t);e.exports={validation:function(e){if('SequelizeValidationError'==e.name){var t=[];return e.errors.map(function(e){t.push(e.path+':'+e.validatorKey)}),l.error('SequelizeValidationError'),l.error(e.message),t.join(',')}return l.error(e),e}}}).call(t,'/')},function(e,t,r){'use strict';/*!
 * utils v1.0.0
 * 工具类,提供各种工具方法，会陆续添加
 *
 * Author: liaoxm
 * Date: 2019-07-22
 *
 */function a(e){return e&&e.__esModule?e:{default:e}}function l(e){var t={};for(var r in e)t[r]='object'===(0,p.default)(e[r])?l(e[r]):e[r];return t}var o=r(28),d=a(o),s=r(6),n=a(s),u=r(29),p=a(u),i=r(30),R=function(e,t,r){var a=i.createHash(e),l=Buffer.isBuffer(t);return l||'object'!==('undefined'==typeof t?'undefined':(0,p.default)(t))||(t=(0,n.default)(_(t))),a.update(t,l?'binary':'utf8'),a.digest(r||'hex')},_=function e(t){if(!t||Array.isArray(t)||'object'!==('undefined'==typeof t?'undefined':(0,p.default)(t)))return t;var r=(0,d.default)(t);r.sort();for(var a,l=[],s=0;s<r.length;s++)a=r[s],l.push([a,e(t[a])]);return l};e.exports={offset:function(e,r){var a={};if(r=r?r:!!e.offsetParent&&e.offsetParent,!r)return a.left=0,a.top=0,a;for(var o=0,l=0,t=e;r!=t;){if(t.offsetParent!=r)o+=t.offsetLeft,l+=t.offsetTop;else{o+=t.offsetLeft,l+=t.offsetTop;break}t=t.offsetParent}return a.left=o,a.top=l,a},query:function(e){return document.querySelector(e)},queryAll:function(e){return document.querySelectorAll(e)},sortObject:_,base64decode:function(e,t){var r=new Buffer(e,'base64');return'buffer'===t?r:r.toString(t||'utf8')},base64encode:function(e){Buffer.isBuffer(e)||(e=new Buffer(e));var t=e.toString('base64');return!1,t},sha256:function(e,t){return R('sha256',e,t)},sha1:function(e,t){return R('sha1',e,t)},md5:function(e,t){return R('md5',e,t)},clone:function e(t){var r;switch('undefined'==typeof t?'undefined':(0,p.default)(t)){case'undefined':break;case'string':r=t+'';break;case'number':r=t-0;break;case'boolean':r=t;break;case'object':if(null===t)r=null;else if(t instanceof Array){r=[];for(var a=0,l=t.length;a<l;a++)r.push(e(t[a]))}else for(var o in r={},t)r[o]=e(t[o]);break;default:r=t;}return r},getQueryString:function(e){var t=new RegExp('(^|&)'+e+'=([^&]*)(&|$)','i'),a=window.location.search.substr(1).match(t);return null==a?null:unescape(a[2])},deepCopy:l,bubbleSort:function(e,t){if(null==e)return null;for(var r=0;r<e.length;r++)for(var a=0;a<e.length-r-1;a++)if(e[a][t]-0>e[a+1][t]-0){var l=e[a+1];e[a+1]=e[a],e[a]=l}return e},processKeyAndData:function(e,t,r,a){var l,o=r?/([A-Z])/g:/_(.)/g,d=r?''.toLocaleLowerCase:''.toLocaleUpperCase;for(var s in t)a&&-1==a.indexOf(s)||(l=s.replace(o,function(){return r?'_'+d.call(arguments[1]):d.call(arguments[1])}),e[l]=t[s])},tofixed:function(e){return e=e||'0.00',parseFloat(e.toString()).toFixed(2)},objectType:function(e,t){var r=Object.prototype.toString,a=r.call(e);return a=a.substring(8,a.length-1),t&&a==t,a},time:function(){return Date.parse(new Date)/1e3}}},function(e){e.exports=require('fs')},function(e){e.exports=require('path')},function(e){e.exports=require('koa')},function(e){e.exports=require('babel-runtime/helpers/extends')},function(e,t,r){'use strict';function a(e){return e&&e.__esModule?e:{default:e}}var l=r(1),o=a(l),d=r(9),s=a(d),n=r(2),u=a(n),p=r(12),i=function(){var e=(0,u.default)(o.default.mark(function e(t){var r,a,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,a=t.type,l=t.newName,d=t.txt,e.abrupt('return',new s.default(function(e,t){switch(a){case'stat':p.stat(r,function(r,a){return r?(t(r),!1):void e(a)});break;case'mkdir':p.mkdir(r,function(r){return r?(t(r),!1):void e(1)});break;case'writeFile':p.writeFileSync(r,d,'utf8',function(r){return r?(t(r),!1):void e(1)});break;case'appendFile':p.appendFile(r,d,'utf8',function(r){return r?(t(r),!1):void e(1)});break;case'readFile':p.readFile(r,'utf8',function(r,a){return r?(t(r),!1):void e(a)});break;case'readdir':p.readdir(r,function(r,a){return r?(t(r),!1):void e(a)});break;case'rename':p.rename(r,l,function(r){return r?(t(r),!1):void e(1)});break;case'rmdir':p.rmdir(r,function(r){return r?(t(r),!1):void e(1)});break;case'unlink':p.unlink(r,function(r){return r?(t(r),!1):void e(1)});break;case'createReadStream':var o=p.createReadStream(r),s='';o.on('data',function(e){s+=e}),o.on('end',function(){e(s)}),o.on('error',function(e){t(e)});break;case'createWriteStream':var n=d,u=p.createWriteStream(r);u.write(n,'UTF8'),u.end(),u.on('finish',function(){e(1)}),u.on('error',function(e){t(e)});break;case'pipe':var i=p.createReadStream(r),u=p.createWriteStream(l);i.pipe(u),u.on('finish',function(){e(l)}),u.on('error',function(e){t(e)});break;case'access':p.access('package.json',function(t){e(t)});break;case'mkdirFile':var R=r.split('/'),_='';R.forEach(function(r,a){r&&(_+='/'+r,!p.existsSync(_)&&p.mkdirSync(_,function(e){t(e)}),R.length-2==a&&e(1))});}}));case 2:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports={fileUtils:i}},function(e,t,r){'use strict';var a=r(14),l=r(18),o=r(19),d=r(20),s=r(21),n=r(5),u=r(22),i=r(0),p=r(49),R=r(13),_=new a,E={user:n.database.USERNAME,password:n.database.PASSWORD,database:n.database.DATABASE,host:n.database.HOST};_.use(d({key:'USER_SID',store:new s(E)})),_.use(l({formLimit:'1mb',multipart:!0,formidable:{maxFileSize:n.upload.MAXFILESIZE,keepExtensions:!0}})),_.use(o()),_.use(p(R.join(n.upload.UPLOAD))),_.use(i.httpHead()),_.use(u()),_.listen(n.port),console.log('listening on port '+n.port)},function(e){e.exports=require('koa-body')},function(e){e.exports=require('koa-cors')},function(e){e.exports=require('koa-session-minimal')},function(e){e.exports=require('koa-mysql-session')},function(e,t,r){'use strict';(function(e){var t=r(24),a=r(37),l=r(39),o=r(41),d=r(44),s=r(46),n=r(14),u=r(47),i=r(48),p=i(),R='/article/v1/',_=r(0),E=_.logFile('router'),f=u(e,'./controller',{visit:function(e){for(var t in e)if(t.startsWith('GET ')){var r=R+t.substring(4);p.get(r,e[t]),E.info('register URL mapping: GET '+r)}else if(t.startsWith('POST ')){var r=R+t.substring(5);p.post(r,e[t]),E.info('register URL mapping: POST '+r)}else E.info('invalid URL: '+t)}});e.exports=function(){return p.routes()}}).call(t,r(23)(e))},function(e){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],!e.children&&(e.children=[]),Object.defineProperty(e,'loaded',{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,'id',{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){'use strict';(function(t){function a(e){return e&&e.__esModule?e:{default:e}}var l,o=r(3),d=a(o),s=r(25),n=a(s),u=r(1),i=a(u),p=r(15),R=a(p),_=r(2),E=a(_),f=r(7).Op,m=r(4),c=r(10),y=r(11),O=r(8).Article,S=r(0),T=S.logFile(t),N=function(){var e=(0,E.default)(i.default.mark(function e(t){var r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.request.body,a=Date.parse(new Date)/1e3,e.next=4,O.create((0,R.default)({},r,{create_time:a,update_time:a})).then(function(e){var r={error_code:m.ERROR_CODE.SUCCESS,result_data:e};t.body=r}).catch(function(e){var r={error_code:m.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:c.validation(e)};t.body=r});case 4:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,E.default)(i.default.mark(function e(t){var r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.request.body,a=Date.parse(new Date)/1e3,r.map(function(e){e.create_time=a,e.update_time=a}),e.next=5,O.bulkCreate([].concat((0,n.default)(r))).then(function(e){var r={error_code:m.ERROR_CODE.SUCCESS,result_data:e};t.body=r}).catch(function(e){var r={error_code:m.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:c.validation(e)};t.body=r});case 5:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=(0,E.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.findOne({where:{id:t.params.id}}).then(function(e){var r={error_code:m.ERROR_CODE.SUCCESS,result_data:e};t.body=r}).catch(function(e){var r={error_code:m.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:e};t.body=r});case 2:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),C=function(){var e=(0,E.default)(i.default.mark(function e(t){var r,a,l,o,s,u,p,R,_,E,c,S,N,h,b,C,A;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.request.body,a=r.where,l=void 0===a?{}:a,o=r.order,s=void 0===o?[['create_time','DESC']]:o,u=r.keyword,p=r.id,R=r.title,_=r.status,E=r.type,c=r.order_key,S=r.start_date,N=r.end_date,h=r.row_start,b=void 0===h?0:h,C=r.row_count,A=void 0===C?10:C,(p||0===p)&&(l.id=p),R&&(l.title=(0,d.default)({},f.like,'%'+R+'%')),(_||0===_)&&(l.status=_),(E||0===E)&&(l.type=E),S&&N&&(l.create_time=(0,d.default)({},f.between,[S,N])),u&&(l[f.or]=[{title:(0,d.default)({},f.like,'%'+u+'%')},{content:(0,d.default)({},f.like,'%'+u+'%')},{summary:(0,d.default)({},f.like,'%'+u+'%')},{classify:(0,d.default)({},f.like,'%'+u+'%')}]),c&&y.objectType(c,'Array')&&(s=c),e.next=10,O.findAndCountAll({where:l,order:[].concat((0,n.default)(s)),offset:parseInt(b),limit:parseInt(A)}).then(function(e){var r={error_code:m.ERROR_CODE.SUCCESS,result_data:{items:e.rows},total_row:e.count||0};t.body=r}).catch(function(e){T.error(e);var r={error_code:m.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:e};t.body=r});case 10:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),A=function(){var e=(0,E.default)(i.default.mark(function e(t){var r,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.request.body,a=Date.parse(new Date)/1e3,e.next=4,O.update((0,R.default)({},r,{update_time:a}),{where:{id:r.id}}).then(function(e){var r={error_code:e[0]?m.ERROR_CODE.SUCCESS:m.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:e[0]?'\u66F4\u65B0\u5B8C\u6210':'\u66F4\u65B0\u5931\u8D25'};t.body=r}).catch(function(e){var r={error_code:m.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:e};t.body=r});case 4:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),x=function(){var e=(0,E.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.params.id,e.next=3,O.destroy({where:{id:r}}).then(function(e){var r={error_code:m.ERROR_CODE.SUCCESS,result_data:e};t.body=r}).catch(function(e){var r={error_code:m.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:e};t.body=r});case 3:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(l={},(0,d.default)(l,'POST add',N),(0,d.default)(l,'POST add_list',h),(0,d.default)(l,'GET select/:id',b),(0,d.default)(l,'POST article_list',C),(0,d.default)(l,'POST search',C),(0,d.default)(l,'POST update',A),(0,d.default)(l,'GET del/:id',x),l)}).call(t,'/')},function(e){e.exports=require('babel-runtime/helpers/toConsumableArray')},function(e){e.exports=require('log4js')},function(e){e.exports={pm2:!0,disableClustering:!0,appenders:{access:{type:'dateFile',filename:'/logs/access.log',pattern:'-yyyy-MM-dd'},"rule-console":{type:'console'},"rule-error":{type:'dateFile',filename:'/logs/error-',encoding:'utf-8',maxLogSize:1e6,numBackups:3,pattern:'yyyy-MM-dd.log',alwaysIncludePattern:!0}},categories:{default:{appenders:['rule-console','rule-error'],level:'debug'},http:{appenders:['access'],level:'info'}}}},function(e){e.exports=require('babel-runtime/core-js/object/keys')},function(e){e.exports=require('babel-runtime/helpers/typeof')},function(e){e.exports=require('crypto')},function(e,t,r){'use strict';var a=r(9),l=function(e){return e&&e.__esModule?e:{default:e}}(a),o=r(32);e.exports={sendEmail:function(e,t,r,a,d){return new l.default(function(l,s){var n=o.createTransport({service:'163',secureConnection:!0,secure:!0,port:465,auth:{user:e,pass:'yanjiang123'}});n.sendMail({from:t+' <'+e+'>',to:r,subject:a,html:d},function(e){e?s(e):l()})})}}},function(e){e.exports=require('nodemailer')},function(e){'use strict';e.exports=function(e,t){return e.define('skd_admin',{id:{type:t.INTEGER(11),allowNull:!1,primaryKey:!0,autoIncrement:!0},role_id:{type:t.INTEGER(11),allowNull:!0},email:{type:t.STRING(255),allowNull:!0},password:{type:t.STRING(255),allowNull:!0},name:{type:t.STRING(255),allowNull:!1},phone:{type:t.STRING(255),allowNull:!0},qq:{type:t.STRING(255),allowNull:!0},sex:{type:t.STRING(255),allowNull:!0},content:{type:t.TEXT,allowNull:!0},status:{type:t.INTEGER(4),allowNull:!0,defaultValue:'0'},create_time:{type:t.STRING(20),allowNull:!0},update_time:{type:t.STRING(20),allowNull:!0},last_login_time:{type:t.DATE,allowNull:!0}},{tableName:'skd_admin',timestamps:!1})}},function(e){'use strict';e.exports=function(e,t){return e.define('skd_article',{id:{type:t.INTEGER(11),allowNull:!1,primaryKey:!0,autoIncrement:!0},user_ip:{type:t.STRING(20),allowNull:!0},email:{type:t.STRING(30),allowNull:!0},title:{type:t.STRING(255),allowNull:!1},content:{type:t.TEXT,allowNull:!0},summary:{type:t.STRING(255),allowNull:!0,defaultValue:''},cover:{type:t.STRING(100),allowNull:!0},classify:{type:t.STRING(100),allowNull:!0},type:{type:t.INTEGER(4),allowNull:!1},status:{type:t.INTEGER(4),allowNull:!0,defaultValue:'0'},number:{type:t.INTEGER(20),allowNull:!0,defaultValue:'0'},create_time:{type:t.STRING(20),allowNull:!0},update_time:{type:t.STRING(20),allowNull:!0}},{tableName:'skd_article',timestamps:!1})}},function(e){'use strict';e.exports=function(e,t){return e.define('skd_role',{id:{type:t.INTEGER(11),allowNull:!1,primaryKey:!0,autoIncrement:!0},article_id:{type:t.STRING(255),allowNull:!1},content:{type:t.TEXT,allowNull:!0},status:{type:t.INTEGER(4),allowNull:!0,defaultValue:'0'},create_time:{type:t.DATE,allowNull:!0},update_time:{type:t.DATE,allowNull:!0}},{tableName:'skd_role',timestamps:!1})}},function(e){'use strict';e.exports=function(e,t){return e.define('_mysql_session_store',{id:{type:t.STRING(255),allowNull:!1,primaryKey:!0,autoIncrement:!0},expires:{type:t.BIGINT,allowNull:!0},data:{type:t.TEXT,allowNull:!0}},{tableName:'_mysql_session_store',timestamps:!1})}},function(e,t,r){'use strict';(function(t){function a(e){return e&&e.__esModule?e:{default:e}}var l,o=r(3),d=a(o),s=r(15),n=a(s),u=r(1),i=a(u),p=r(2),R=a(p),_=r(7).Op,E=r(4),f=r(10),m=r(38),c=r(11),y=r(8).Admin,O=r(0),S=O.logFile(t),T=function(){var e=(0,R.default)(i.default.mark(function e(t){var r,a,l,o,d,s,n,u,p,R,_,m,O,S,T,N,h,b,C,A,x,g,I,w,D;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.request.body,a=r.role_id,l=void 0===a?null:a,o=r.email,d=void 0===o?null:o,s=r.user_ticket,n=void 0===s?null:s,u=r.name,p=void 0===u?null:u,R=r.phone,_=void 0===R?null:R,m=r.qq,O=void 0===m?null:m,S=r.sex,T=void 0===S?null:S,N=r.content,h=void 0===N?null:N,b=r.status,C=void 0===b?0:b,A=r.create_time,x=void 0===A?c.time():A,g=r.update_time,I=void 0===g?c.time():g,e.next=3,y.findOne({where:{name:p}});case 3:if(w=e.sent,!w){e.next=8;break}return D={error_code:E.ERROR_CODE.CHECK_ALREADY_EXISTS,error_message:'\u8BE5\u7528\u6237\u540D\u4E00\u88AB\u521B\u5EFA'},t.body=D,e.abrupt('return');case 8:return e.next=10,y.create({role_id:l,email:d,password:n,name:p,phone:_,qq:O,sex:T,content:h,status:C,create_time:x,update_time:I}).then(function(e){var r={error_code:E.ERROR_CODE.SUCCESS,result_data:e};t.body=r}).catch(function(e){var r={error_code:E.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:f.validation(e)};t.body=r});case 10:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),N=function(){var e=(0,R.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.findOne({where:{name:t.params.name}}).then(function(e){var r={error_code:E.ERROR_CODE.SUCCESS,result_data:{is_user:e?1:0}};t.body=r}).catch(function(e){var r={error_code:E.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:f.validation(e)};t.body=r});case 2:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,R.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.request.body,e.next=3,y.findOne({where:{name:r.name}}).then(function(e){var a={};if(e){if(1==e.status)return a.error_code=E.ERROR_CODE.ACCOUNT_CANCELLATION,a.error_message='\u7528\u6237\u5DF2\u6CE8\u9500',void(t.body=a);var l=e.password,o=c.md5(l+r.timestamp);o==r.user_ticket?(delete e.password,a.error_code=E.ERROR_CODE.SUCCESS,a.result_data=e):(a.error_code=E.ERROR_CODE.USERNAME_OR_PASS_ERRROR,a.error_message='\u7528\u6237\u540D\u5BC6\u7801\u9519\u8BEF')}else a.error_code=E.ERROR_CODE.USERNAME_OR_PASS_ERRROR,a.error_message='\u7528\u6237\u540D\u5BC6\u7801\u9519\u8BEF';t.body=a}).catch(function(e){var r={error_code:E.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:f.validation(e)};t.body=r});case 3:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=(0,R.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.findByPk((0,n.default)({},t.params.id)).then(function(e){var r={error_code:E.ERROR_CODE.SUCCESS,result_data:e[0]};t.body=r}).catch(function(e){var r={error_code:E.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:f.validation(e)};t.body=r});case 2:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),C=function(){var e=(0,R.default)(i.default.mark(function e(t){var r,a,l,o,s,u,p,R,c,O,T,N,h,b,C;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.request.body,a=r.where,l=void 0===a?{}:a,o=r.id,s=r.name,u=r.phone,p=r.email,R=r.qq,c=r.start_date,O=r.end_date,T=r.status,N=r.row_start,h=void 0===N?0:N,b=r.row_count,C=void 0===b?10:b,(o||0===o)&&(l.id=o),s&&(l.name=(0,d.default)({},_.like,'%'+s+'%')),u&&(l.phone=(0,d.default)({},_.like,'%'+u+'%')),p&&(l.email=(0,d.default)({},_.like,'%'+p+'%')),R&&(l.qq=(0,d.default)({},_.like,'%'+R+'%')),(T||0===T)&&(l.status=T),c&&O&&(l.create_time=(0,d.default)({},_.between,[c,O])),e.next=10,y.findAndCountAll((0,n.default)({},m.user,{where:l,order:[['create_time','DESC']],offset:parseInt(h),limit:parseInt(C)})).then(function(e){var r={error_code:E.ERROR_CODE.SUCCESS,result_data:{items:e.rows},total_row:e.count||0};t.body=r}).catch(function(e){S.error(e);var r={error_code:E.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:f.validation(e)};t.body=r});case 10:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),A=function(){var e=(0,R.default)(i.default.mark(function e(t){var r,a,l;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.parse(new Date)/1e3,a=t.request.body,l={role_id:a.role_id,email:a.email,name:a.name,phone:a.phone,password:a.user_ticket,qq:a.qq,sex:a.sex,content:a.content,update_time:r,last_login_time:a.last_login_time},(a.status||0===a.status)&&(l.status=a.status),e.next=6,y.update((0,n.default)({},l),{where:{id:a.id}}).then(function(){var e={error_code:E.ERROR_CODE.SUCCESS,error_message:'\u66F4\u65B0\u5B8C\u6210'};t.body=e}).catch(function(e){var r={error_code:E.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:f.validation(e)};t.body=r});case 6:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),x=function(){var e=(0,R.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.params.id,e.next=3,y.destroy({where:{id:r}}).then(function(e){var r={error_code:E.ERROR_CODE.SUCCESS,result_data:{is_user:e}};t.body=r}).catch(function(e){var r={error_code:E.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:f.validation(e)};t.body=r});case 3:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(l={},(0,d.default)(l,'POST admin_add',T),(0,d.default)(l,'GET admin_select/:id',b),(0,d.default)(l,'GET admin_check/:name',N),(0,d.default)(l,'POST admin_login',h),(0,d.default)(l,'POST admin_list',C),(0,d.default)(l,'POST admin_update',A),(0,d.default)(l,'GET admin_del/:id',x),l)}).call(t,'/')},function(e){'use strict';e.exports={user:{attributes:{exclude:['password','ip']}}}},function(e,t,r){'use strict';(function(t){function a(e){return e&&e.__esModule?e:{default:e}}var l=r(3),o=a(l),d=r(1),s=a(d),n=r(2),u=a(n),i=r(12),p=r(13),R=r(4),_=r(40),E=r(5),f=r(0),m=f.logFile(t),c=r(16),y=c.fileUtils,O=function(){var e=(0,u.default)(s.default.mark(function e(t){var r,a,l,o,d,n,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.parse(new Date),a='SDK_'+_.dateFormat(r,_.ISO8601_WITH_TZ_OFFSET_FORMAT),l=t.request.files.file,o=E.upload.UPLOAD+E.upload.IMAGE,d=a.substring(4,8)+'/'+a.substring(8,10),n='blob'==l.name?'png':l.name.split('.').pop(),u=p.join(o,d,a+'.'+n),e.next=9,y({type:'mkdirFile',name:o+d});case 9:return e.next=11,y({type:'pipe',name:l.path,newName:u}).then(function(e){var r=e.substring(E.upload.UPLOAD.length,e.length);t.body={error_code:R.ERROR_CODE.SUCCESS,error_message:'\u4E0A\u4F20\u6587\u4EF6\u6210\u529F',realName:r}}).catch(function(e){m.error(e),t.body={error_code:R.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25\uFF01'}});case 11:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(0,o.default)({},'POST upload',O)}).call(t,'/')},function(e){'use strict';/*!
 * dateFormat.js v1.0.0
 * 日期格式化工具类
 *
 * Author: liaoxm
 * Date: 2016-06-16
 *
 */function t(e,t){for(var r=e+'';r.length<t;)r='0'+r;return r}function r(e){return t(e,2)}function a(e){var t=Math.abs(e),r=Math.floor(t/60)+'',a=t%60+'';return 1===r.length&&(r='0'+r),1===a.length&&(a='0'+a),0>e?'+'+r+a:'-'+r+a}var l='yyyy-MM-dd hh:mm:ss';e.exports={dateFormat:function(e,o,d){if(!e)return e;('string'==typeof e||'number'==typeof e)&&(e=new Date(arguments[0]),o=arguments[1],d=arguments[2]),o===void 0&&(o=l),d===void 0&&(d=e.getTimezoneOffset()),e.setUTCMinutes(e.getUTCMinutes()-d);var s=r(e.getUTCDate()),n=r(e.getUTCMonth()+1),u=r(e.getUTCFullYear()),i=r(e.getUTCFullYear().toString().substring(2,4)),p=-1<o.indexOf('yyyy')?u:i,R=r(e.getUTCHours()),_=r(e.getUTCMinutes()),E=r(e.getUTCSeconds()),f=t(e.getUTCMilliseconds(),3),m=a(d);e.setUTCMinutes(e.getUTCMinutes()+d);var c=o.replace(/dd/g,s).replace(/MM/g,n).replace(/y{1,4}/g,p).replace(/hh/g,R).replace(/mm/g,_).replace(/ss/g,E).replace(/SSS/g,f).replace(/O/g,m);return c},ISO8601_FORMAT:l,ISO8601_FORMAT_WITHOUT_TIME:'yyyy-MM-dd',ISO8601_WITH_TZ_OFFSET_FORMAT:'yyyyMMddhhmmss',DATETIME_FORMAT:'dd MM yyyy hh:mm:ss.SSS',ABSOLUTETIME_FORMAT:'hh:mm:ss.SSS'}},function(e,t,r){'use strict';(function(t){function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t,r){var a=m.readdirSync(t);a.forEach(function(a){var o=t+'/'+a,d=m.statSync(o);if(d.isDirectory()){var s=o.replace(r,''),n=A.folder(s);l(n,o,r)}else e.file(a,m.readFileSync(o))})}var o,d=r(3),s=a(d),n=r(1),u=a(n),i=r(6),p=a(i),R=r(2),_=a(R),E=r(9),f=a(E),m=r(12),c=r(13),y=r(42),O=r(43),S=r(4),T=r(16),N=T.fileUtils,h=r(5),b=r(0),C=b.logFile(t),A=new O,x=[],g=function(e){return new f.default(function(t,r){m.readdir(e,function(a,l){a?r(a):0==l.length?t(x):l.forEach(function(a,o){var d=c.join(e,a);m.stat(d,function(e,a){return e?(r(e),!1):void(a.isDirectory()&&(x.push({name:l[o],type:1}),l.length==x.length&&t(x)),a.isFile()&&(x.push({name:l[o],type:0}),l.length==x.length&&t(x)))})})})})},I=function(){var e=(0,_.default)(u.default.mark(function e(t){var r,a,l;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x=[],r=t.request.body,a=r.path||h.upload.UPLOAD,l=c.resolve(a),e.next=6,g(l).then(function(e){var r=[];e.map(function(e){var t={path:a+'/'+e.name,name:e.name,type:e.type};r.push(t)});var l={error_code:S.ERROR_CODE.SUCCESS,result_data:{items:r,path:a}};C.info((0,p.default)(l)),t.body=l}).catch(function(e){C.error(e);var r={error_code:S.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u670D\u52A1\u5668\u5F02\u5E38'};t.body=r});case 6:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),w=function(){var e=(0,_.default)(u.default.mark(function e(t){var r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.request.body,r.path){e.next=6;break}return C.error(err),a={error_code:S.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u8BF7\u8F93\u5165\u6587\u4EF6\u540D\u79F0'},t.body=a,e.abrupt('return',!1);case 6:return e.next=8,N({type:r.type?'rmdir':'unlink',name:r.path}).then(function(){var e={error_code:S.ERROR_CODE.SUCCESS,result_data:{ischeck:1}};C.info((0,p.default)(e)),t.body=e}).catch(function(e){C.error(e);var r={error_code:S.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u670D\u52A1\u5668\u5F02\u5E38'};return t.body=r,!1});case 8:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),D=function(){var e=(0,_.default)(u.default.mark(function e(t){var r,a,o,d,s,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.query,r.path){e.next=6;break}return C.error(err),a={error_code:S.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u8BF7\u8F93\u5165\u6587\u4EF6\u540D\u79F0'},t.body=a,e.abrupt('return',!1);case 6:if(o={},1!=r.type){e.next=23;break}return d=r.path.split('/'),s=d[d.length-1],n='/upload/temp/',e.next=13,l(A,r.path,r.path);case 13:return e.next=15,N({type:'mkdirFile',name:n});case 15:return e.next=17,A.generateAsync({type:'nodebuffer',compression:'DEFLATE',compressionOptions:{level:9}}).then(function(e){N({type:'writeFile',name:''+n+s+'.zip',txt:e}).then(function(){C.info('\u538B\u7F29\u6210\u529F\uFF01')}).catch(function(e){C.error(e);var r={error_code:S.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u670D\u52A1\u5668\u5F02\u5E38'};return t.body=r,!1})});case 17:return e.next=19,y(t,''+n+s+'.zip',{root:'/'});case 19:return e.next=21,N({type:'unlink',name:''+n+s+'.zip'}).then(function(){C.info('\u6E05\u9664\u6587\u4EF6\u6210\u529F\uFF01')}).catch(function(e){C.error('\u5220\u9664\u6587\u4EF6\u5931\u8D25',e)});case 21:e.next=25;break;case 23:return e.next=25,y(t,r.path,{root:'/'});case 25:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(o={},(0,s.default)(o,'POST file_catalogue',I),(0,s.default)(o,'POST del_file',w),(0,s.default)(o,'GET download_file',D),o)}).call(t,'/')},function(e){e.exports=require('koa-send')},function(e){e.exports=require('jszip')},function(e,t,r){'use strict';(function(t){function a(e){return e&&e.__esModule?e:{default:e}}var l=r(3),o=a(l),d=r(6),s=a(d),n=r(1),u=a(n),i=r(9),p=a(i),R=r(2),_=a(R),E=r(45),f=r(4),m=r(5),c=r(0),y=c.logFile(t),O=function(){var e=(0,_.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r='http://music.163.com/api/playlist/detail?id='+t,e.abrupt('return',new p.default(function(e,t){E.get(r,function(t){var r='';t.on('data',function(e){r+=e}),t.on('end',function(){e(r)})}).on('error',function(r){t(r)})}));case 2:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),S=function(){var e=(0,_.default)(u.default.mark(function e(t){var r,a,l;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r='http://music.163.com/song/media/outer/url?id=',a=t.params.id,a||(y.error('\u8BF7\u586B\u5199ID'),l={error_code:f.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u8BF7\u586B\u5199ID'},t.body=l),e.next=5,O(a).then(function(e){if(e=JSON.parse(e),200!=e.code)throw new Error('Sync Error');var a=[];(e.result.tracks||[]).map(function(e){var t={name:e.name,artist:e.artists?e.artists[0].name:'\u97F3\u4E50\u662F\u4E16\u754C\u7684',id:e.id,cover:e.album?e.album.picUrl:'http://p1.music.126.net/6y-UleORITEDbvrOLV0Q8A==/5639395138885805.jpg',url:''+r+e.id+'.mp3 '};a.push(t)});var l={error_code:f.ERROR_CODE.SUCCESS,result_data:{items:a}};y.info((0,s.default)(l)),t.body=l}).catch(function(e){y.error(e);var r={error_code:f.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:'\u670D\u52A1\u5668\u5F02\u5E38'};t.body=r});case 5:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(0,o.default)({},'GET music_163/:id',S)}).call(t,'/')},function(e){e.exports=require('http')},function(e,t,r){'use strict';(function(t){function a(e){return e&&e.__esModule?e:{default:e}}var l=r(3),o=a(l),d=r(1),s=a(d),n=r(6),u=a(n),i=r(2),p=a(i),R=r(7).Op,_=r(4),E=r(10),f=r(11),m=r(8).Admin,c=r(8).Role,y=r(0),O=y.logFile(t),S=function(){var e=(0,p.default)(s.default.mark(function e(t){var r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r='admin',e.next=3,m.findAll({attributes:['name'],include:[{model:r,as:c,attributes:['name']}]}).then(function(e){var r={error_code:_.ERROR_CODE.SUCCESS,result_data:e};O.error((0,u.default)(r)),t.body=r}).catch(function(e){var r={error_code:_.ERROR_CODE.INTERNAL_SERVER_ERROR,error_message:E.validation(e)};t.body=r});case 3:case'end':return e.stop();}},e,void 0)}));return function(){return e.apply(this,arguments)}}();e.exports=(0,o.default)({},'GET test',S)}).call(t,'/')},function(e){e.exports=require('require-directory')},function(e){e.exports=require('koa-router')},function(e){e.exports=require('koa-static')}]);